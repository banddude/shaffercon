<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Classic Hopscotch - AIVA Games</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            font-family: 'Arial', sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            overflow: hidden;
        }

        #gameContainer {
            position: relative;
            width: 100%;
            max-width: 500px;
            height: 90vh;
            background: linear-gradient(180deg, #0f3460 0%, #1a1a2e 100%);
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
            overflow: hidden;
        }

        #gameCanvas {
            display: block;
            width: 100%;
            height: 100%;
        }

        #ui {
            position: absolute;
            top: 20px;
            left: 20px;
            right: 20px;
            color: white;
            font-size: 18px;
            font-weight: bold;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
            pointer-events: none;
            z-index: 10;
        }

        .ui-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
        }

        #score, #round, #instruction {
            background: rgba(0, 0, 0, 0.5);
            padding: 10px 20px;
            border-radius: 10px;
            border: 2px solid #0284c7;
        }

        #instruction {
            width: 100%;
            text-align: center;
            font-size: 16px;
            margin-top: 10px;
        }

        #startScreen, #gameOverScreen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 100;
        }

        #gameOverScreen {
            display: none;
        }

        h1 {
            color: #0284c7;
            font-size: 48px;
            margin-bottom: 20px;
            text-shadow: 0 0 20px #0284c7;
        }

        h2 {
            color: white;
            font-size: 32px;
            margin-bottom: 30px;
        }

        .btn {
            background: linear-gradient(135deg, #0284c7 0%, #0369a1 100%);
            color: white;
            border: none;
            padding: 15px 40px;
            font-size: 24px;
            border-radius: 10px;
            cursor: pointer;
            margin: 10px;
            transition: all 0.3s;
            box-shadow: 0 5px 15px rgba(2, 132, 199, 0.4);
        }

        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(2, 132, 199, 0.6);
        }

        .instructions {
            color: #a9a9a9;
            font-size: 16px;
            max-width: 400px;
            text-align: center;
            margin: 20px;
            line-height: 1.6;
        }

        #finalScore {
            color: #0284c7;
            font-size: 48px;
            margin: 20px 0;
        }

        .controls {
            display: flex;
            gap: 20px;
            margin-top: 20px;
        }

        .control-btn {
            background: rgba(2, 132, 199, 0.3);
            border: 2px solid #0284c7;
            color: white;
            width: 80px;
            height: 80px;
            border-radius: 50%;
            font-size: 36px;
            cursor: pointer;
            transition: all 0.2s;
            user-select: none;
        }

        .control-btn:active {
            transform: scale(0.9);
            background: rgba(2, 132, 199, 0.5);
        }
    </style>
</head>
<body>
    <div id="gameContainer">
        <canvas id="gameCanvas"></canvas>

        <div id="ui">
            <div class="ui-row">
                <div id="score">Score: 0</div>
                <div id="round">Round: 1</div>
            </div>
            <div id="instruction">Use arrows to move, SPACE to jump</div>
        </div>

        <div id="startScreen">
            <h1>⚡ Classic Hopscotch ⚡</h1>
            <p class="instructions">
                Play classic hopscotch with physics!<br><br>
                <strong>Controls:</strong><br>
                LEFT/RIGHT arrows to move<br>
                SPACE to jump<br><br>
                <strong>How to play:</strong><br>
                1. Land on the glowing square to throw your marker<br>
                2. Jump through all squares EXCEPT the one with your marker<br>
                3. Reach the top (square 10)<br>
                4. Jump back down (still skip the marker square)<br>
                5. Pick up your marker and return to start<br>
                6. Complete all 10 rounds to win!
            </p>
            <button class="btn" onclick="startGame()">Start Game</button>
            <div class="controls">
                <button class="control-btn" id="leftBtn">←</button>
                <button class="control-btn" id="jumpBtn">↑</button>
                <button class="control-btn" id="rightBtn">→</button>
            </div>
        </div>

        <div id="gameOverScreen">
            <h2 id="endTitle">Game Over!</h2>
            <div id="finalScore">Score: 0</div>
            <button class="btn" onclick="restartGame()">Play Again</button>
            <button class="btn" onclick="location.reload()">Back to Menu</button>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');

        function resizeCanvas() {
            canvas.width = canvas.offsetWidth;
            canvas.height = canvas.offsetHeight;
        }
        resizeCanvas();
        window.addEventListener('resize', resizeCanvas);

        // Game variables
        let gameRunning = false;
        let score = 0;
        let currentRound = 1;
        let gamePhase = 'THROW_SETUP';
        let markerSquare = 0;
        let targetSquare = 1;
        let visitedSquares = new Set();
        let squares = [];
        let particles = [];
        let marker = null;

        // Player
        const player = {
            x: 0,
            y: 0,
            width: 30,
            height: 30,
            vx: 0,
            vy: 0,
            onGround: false,
            color: '#0284c7'
        };

        // Physics
        const gravity = 0.8;
        const jumpPower = -18;
        const moveSpeed = 7;
        const friction = 0.85;

        // Controls
        const keys = {};

        window.addEventListener('keydown', (e) => {
            keys[e.code] = true;
            if (gameRunning && (e.code === 'Space' || e.code === 'ArrowUp') && player.onGround) {
                player.vy = jumpPower;
                player.onGround = false;
            }
        });

        window.addEventListener('keyup', (e) => {
            keys[e.code] = false;
        });

        // Touch controls
        document.getElementById('leftBtn').addEventListener('touchstart', (e) => {
            e.preventDefault();
            keys['ArrowLeft'] = true;
        });
        document.getElementById('leftBtn').addEventListener('touchend', (e) => {
            e.preventDefault();
            keys['ArrowLeft'] = false;
        });

        document.getElementById('rightBtn').addEventListener('touchstart', (e) => {
            e.preventDefault();
            keys['ArrowRight'] = true;
        });
        document.getElementById('rightBtn').addEventListener('touchend', (e) => {
            e.preventDefault();
            keys['ArrowRight'] = false;
        });

        document.getElementById('jumpBtn').addEventListener('touchstart', (e) => {
            e.preventDefault();
            if (gameRunning && player.onGround) {
                player.vy = jumpPower;
                player.onGround = false;
            }
        });

        // Mouse controls
        document.getElementById('leftBtn').addEventListener('mousedown', () => keys['ArrowLeft'] = true);
        document.getElementById('leftBtn').addEventListener('mouseup', () => keys['ArrowLeft'] = false);
        document.getElementById('rightBtn').addEventListener('mousedown', () => keys['ArrowRight'] = true);
        document.getElementById('rightBtn').addEventListener('mouseup', () => keys['ArrowRight'] = false);
        document.getElementById('jumpBtn').addEventListener('mousedown', () => {
            if (gameRunning && player.onGround) {
                player.vy = jumpPower;
                player.onGround = false;
            }
        });

        // Initialize squares
        function initSquares() {
            squares = [];
            const squareSize = 80;
            const centerX = canvas.width / 2;
            const startY = canvas.height - 80;
            const gap = 100;

            // Classic pattern: 1, 2-3, 4, 5-6, 7, 8-9, 10
            const pattern = [
                [1],
                [2, 3],
                [4],
                [5, 6],
                [7],
                [8, 9],
                [10]
            ];

            // Starting platform
            squares.push({
                number: 0,
                x: centerX - squareSize / 2,
                y: startY,
                width: squareSize,
                height: 20,
                isStart: true
            });

            player.x = centerX - player.width / 2;
            player.y = startY - 20 - player.height;
            player.vx = 0;
            player.vy = 0;
            player.onGround = true;

            pattern.forEach((row, idx) => {
                const y = startY - ((idx + 1) * gap);

                if (row.length === 1) {
                    squares.push({
                        number: row[0],
                        x: centerX - squareSize / 2,
                        y: y,
                        width: squareSize,
                        height: 20,
                        isStart: false
                    });
                } else {
                    squares.push({
                        number: row[0],
                        x: centerX - squareSize - 5,
                        y: y,
                        width: squareSize,
                        height: 20,
                        isStart: false
                    });
                    squares.push({
                        number: row[1],
                        x: centerX + 5,
                        y: y,
                        width: squareSize,
                        height: 20,
                        isStart: false
                    });
                }
            });
        }

        // Particles
        function createParticles(x, y, color) {
            for (let i = 0; i < 15; i++) {
                particles.push({
                    x: x,
                    y: y,
                    vx: (Math.random() - 0.5) * 8,
                    vy: (Math.random() - 0.5) * 8 - 2,
                    life: 1,
                    color: color
                });
            }
        }

        function updateParticles() {
            particles = particles.filter(p => p.life > 0);
            particles.forEach(p => {
                p.x += p.vx;
                p.y += p.vy;
                p.vy += 0.3;
                p.life -= 0.02;
            });
        }

        function drawParticles() {
            particles.forEach(p => {
                ctx.globalAlpha = p.life;
                ctx.fillStyle = p.color;
                ctx.fillRect(p.x, p.y, 4, 4);
            });
            ctx.globalAlpha = 1;
        }

        // Update
        function update() {
            if (!gameRunning) return;

            // Player movement
            if (keys['ArrowLeft']) {
                player.vx = -moveSpeed;
            } else if (keys['ArrowRight']) {
                player.vx = moveSpeed;
            } else {
                player.vx *= friction;
            }

            player.x += player.vx;
            player.vy += gravity;
            player.y += player.vy;

            // Bounds
            if (player.x < 0) player.x = 0;
            if (player.x + player.width > canvas.width) player.x = canvas.width - player.width;

            // Game over if fall
            if (player.y > canvas.height + 50) {
                gameOver(false);
                return;
            }

            // Collision
            player.onGround = false;
            squares.forEach(square => {
                if (player.x + player.width > square.x &&
                    player.x < square.x + square.width &&
                    player.y + player.height >= square.y &&
                    player.y + player.height <= square.y + square.height + 10 &&
                    player.vy >= 0) {

                    player.y = square.y - player.height;
                    player.vy = 0;
                    player.onGround = true;

                    // Handle landing on square
                    handleLanding(square);
                }
            });

            updateParticles();
        }

        function handleLanding(square) {
            if (gamePhase === 'THROW_SETUP' && square.number === targetSquare) {
                // Throw marker
                marker = {
                    x: square.x + square.width / 2,
                    y: square.y - 25,
                    square: targetSquare
                };
                markerSquare = targetSquare;
                createParticles(marker.x, marker.y + 10, '#fbbf24');
                gamePhase = 'HOP_UP';
                visitedSquares.clear();
                score += 10;
                updateUI();
                updateInstruction();
            } else if (gamePhase === 'HOP_UP') {
                if (square.number === markerSquare && square.number !== 0) {
                    // Stepped on marker square!
                    gameOver(false);
                    return;
                }

                if (square.number > 0 && !visitedSquares.has(square.number)) {
                    visitedSquares.add(square.number);
                    createParticles(square.x + square.width / 2, square.y, '#0284c7');
                    score += 10;
                    updateUI();
                }

                if (square.number === 10) {
                    gamePhase = 'HOP_DOWN';
                    updateInstruction();
                }
            } else if (gamePhase === 'HOP_DOWN') {
                if (square.number === markerSquare && square.number !== 0) {
                    // Stepped on marker square!
                    gameOver(false);
                    return;
                }

                // Pickup marker
                if (marker && Math.abs(player.x + player.width / 2 - marker.x) < 40 &&
                    Math.abs(player.y + player.height - marker.y) < 50) {
                    createParticles(marker.x, marker.y, '#fbbf24');
                    marker = null;
                    score += 50;
                    updateUI();
                    gamePhase = 'RETURN';
                    updateInstruction();
                }

                // Check if back at start
                if (square.number === 0 && square.isStart && !marker) {
                    roundComplete();
                }
            } else if (gamePhase === 'RETURN') {
                if (square.number === 0 && square.isStart) {
                    roundComplete();
                }
            }
        }

        function roundComplete() {
            score += 100;
            currentRound++;

            if (currentRound > 10) {
                gameOver(true);
            } else {
                targetSquare = currentRound;
                gamePhase = 'THROW_SETUP';
                marker = null;
                markerSquare = 0;
                visitedSquares.clear();
                updateUI();
                updateInstruction();
            }
        }

        function updateInstruction() {
            const inst = document.getElementById('instruction');
            switch(gamePhase) {
                case 'THROW_SETUP':
                    inst.textContent = `Land on square ${targetSquare} to throw marker`;
                    break;
                case 'HOP_UP':
                    inst.textContent = `Jump to square 10 (skip ${markerSquare})`;
                    break;
                case 'HOP_DOWN':
                    inst.textContent = marker ? `Jump back and pick up marker (skip ${markerSquare})` : `Jump back to start (skip ${markerSquare})`;
                    break;
                case 'RETURN':
                    inst.textContent = 'Jump back to start to complete round!';
                    break;
            }
        }

        // Draw
        function draw() {
            ctx.fillStyle = '#0f3460';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // Squares
            squares.forEach(square => {
                ctx.fillStyle = 'rgba(0, 0, 0, 0.3)';
                ctx.fillRect(square.x + 3, square.y + 3, square.width, square.height);

                const isTarget = (gamePhase === 'THROW_SETUP' && square.number === targetSquare);
                const hasMarker = (square.number === markerSquare && square.number !== 0);
                const isVisited = visitedSquares.has(square.number);

                if (square.isStart) {
                    ctx.fillStyle = '#1a5f3a';
                } else if (hasMarker) {
                    ctx.fillStyle = '#4a1a1a';
                } else if (isTarget) {
                    ctx.fillStyle = '#0284c7';
                } else if (isVisited) {
                    ctx.fillStyle = '#2a4a3a';
                } else {
                    ctx.fillStyle = '#16213e';
                }
                ctx.fillRect(square.x, square.y, square.width, square.height);

                ctx.strokeStyle = isTarget ? '#0284c7' : (hasMarker ? '#ff6b6b' : '#2a3f5f');
                ctx.lineWidth = 2;
                ctx.strokeRect(square.x, square.y, square.width, square.height);

                if (!square.isStart) {
                    ctx.fillStyle = hasMarker ? '#ff6b6b' : (isTarget ? 'white' : '#6b7280');
                    ctx.font = 'bold 24px Arial';
                    ctx.textAlign = 'center';
                    ctx.textBaseline = 'middle';
                    ctx.fillText(square.number, square.x + square.width / 2, square.y + square.height / 2);
                }

                if (isTarget) {
                    ctx.strokeStyle = '#0284c7';
                    ctx.shadowBlur = 15;
                    ctx.shadowColor = '#0284c7';
                    ctx.strokeRect(square.x, square.y, square.width, square.height);
                    ctx.shadowBlur = 0;
                }
            });

            // Marker
            if (marker) {
                ctx.save();
                ctx.translate(marker.x, marker.y);
                ctx.shadowBlur = 20;
                ctx.shadowColor = '#fbbf24';
                ctx.fillStyle = '#fbbf24';
                ctx.beginPath();
                for (let i = 0; i < 5; i++) {
                    const angle = (Math.PI * 2 / 5) * i - Math.PI / 2;
                    const x = Math.cos(angle) * 15;
                    const y = Math.sin(angle) * 15;
                    if (i === 0) ctx.moveTo(x, y);
                    else ctx.lineTo(x, y);
                    const innerAngle = angle + Math.PI / 5;
                    const ix = Math.cos(innerAngle) * 7;
                    const iy = Math.sin(innerAngle) * 7;
                    ctx.lineTo(ix, iy);
                }
                ctx.closePath();
                ctx.fill();
                ctx.shadowBlur = 0;
                ctx.restore();
            }

            drawParticles();

            // Player
            ctx.save();
            ctx.translate(player.x + player.width / 2, player.y + player.height / 2);
            ctx.shadowBlur = 15;
            ctx.shadowColor = player.color;
            ctx.fillStyle = player.color;
            ctx.beginPath();
            ctx.arc(0, 0, player.width / 2, 0, Math.PI * 2);
            ctx.fill();

            const sparkCount = 8;
            const time = Date.now() / 200;
            for (let i = 0; i < sparkCount; i++) {
                const angle = (Math.PI * 2 / sparkCount) * i + time;
                const distance = player.width / 2 + 5 + Math.sin(time * 2 + i) * 2;
                const x = Math.cos(angle) * distance;
                const y = Math.sin(angle) * distance;
                ctx.fillStyle = '#fbbf24';
                ctx.fillRect(x - 2, y - 2, 4, 4);
            }

            ctx.shadowBlur = 0;
            ctx.restore();
        }

        function gameLoop() {
            update();
            draw();
            requestAnimationFrame(gameLoop);
        }

        function updateUI() {
            document.getElementById('score').textContent = `Score: ${score}`;
            document.getElementById('round').textContent = `Round: ${currentRound}`;
        }

        function startGame() {
            document.getElementById('startScreen').style.display = 'none';
            gameRunning = true;
            score = 0;
            currentRound = 1;
            targetSquare = 1;
            gamePhase = 'THROW_SETUP';
            markerSquare = 0;
            visitedSquares.clear();
            marker = null;
            particles = [];
            initSquares();
            updateUI();
            updateInstruction();
        }

        function gameOver(won) {
            gameRunning = false;
            document.getElementById('endTitle').textContent = won ? 'You Won!' : 'Game Over!';
            document.getElementById('finalScore').textContent = `Score: ${score}`;
            document.getElementById('gameOverScreen').style.display = 'flex';

            const name = prompt((won ? "Congratulations! " : "Game Over! ") + "Enter your name:", "Player");
            if (name) {
                saveScore(name, score);
            }
        }

        function saveScore(name, score) {
            let leaderboard = JSON.parse(localStorage.getItem('classic-hopscotch-leaderboard') || '[]');
            leaderboard.push({ name, score });
            leaderboard.sort((a, b) => b.score - a.score);
            leaderboard = leaderboard.slice(0, 10);
            localStorage.setItem('classic-hopscotch-leaderboard', JSON.stringify(leaderboard));
        }

        function restartGame() {
            document.getElementById('gameOverScreen').style.display = 'none';
            score = 0;
            currentRound = 1;
            targetSquare = 1;
            gamePhase = 'THROW_SETUP';
            markerSquare = 0;
            visitedSquares.clear();
            marker = null;
            particles = [];

            for (let key in keys) {
                keys[key] = false;
            }

            initSquares();
            updateUI();
            updateInstruction();
            gameRunning = true;
        }

        gameLoop();
    </script>
</body>
</html>
